name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install Memvid CLI
      run: npm install -g memvid
    
    - name: Check Python syntax
      run: |
        python3 -m py_compile tools/log.py
        echo "✓ Python syntax OK"
    
    - name: Check shell scripts
      run: |
        if command -v shellcheck &> /dev/null; then
          shellcheck install.sh
          echo "✓ Shell scripts OK"
        else
          echo "⚠ shellcheck not installed, skipping"
        fi
    
    - name: Test log.py imports
      run: |
        python3 -c "import tools.log" || echo "⚠ Import test skipped (needs full environment)"
    
    - name: Validate JSON files
      run: |
        python3 -c "import json; json.load(open('package.json'))"
        echo "✓ package.json valid"
    
    - name: Check file structure
      run: |
        test -f README.md
        test -f LICENSE
        test -f SKILL.md
        test -f package.json
        test -f tools/log.py
        test -x tools/log.py
        echo "✓ File structure OK"
